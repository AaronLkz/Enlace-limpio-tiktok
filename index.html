<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Limpiar enlace de TikTok</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: 2rem auto;
      padding: 1rem;
    }
    input, button {
      width: 100%;
      padding: 0.75rem;
      margin-top: 1rem;
      font-size: 1rem;
    }
    #resultado {
      margin-top: 1.5rem;
      font-weight: bold;
      word-wrap: break-word;
    }
  </style>
</head>
<body>
  <h2>Limpiador de Enlaces TikTok</h2>
  <input type="text" id="inputLink" placeholder="Pega aquÃ­ el enlace de TikTok">
  <button onclick="limpiarEnlace()">Limpiar enlace</button>
  <div id="resultado"></div>

  <script>
    async function expandirUrl(url) {
      try {
        const response = await fetch(url, {
          method: 'HEAD',
          redirect: 'follow',
        });
        return response.url;
      } catch (error) {
        return null;
      }
    }

    function limpiarQuery(url) {
      try {
        const u = new URL(url);
        u.search = ''; // Quita ?_t= y otras claves
        u.hash = '';   // Por si tiene #
        return u.toString();
      } catch (e) {
        return null;
      }
    }

    async function limpiarEnlace() {
      const entrada = document.getElementById('inputLink').value.trim();
      const resultado = document.getElementById('resultado');
      resultado.textContent = 'Procesando...';

      if (!entrada) {
        resultado.textContent = 'Por favor ingresa un enlace.';
        return;
      }

      let finalUrl = entrada;

      // Si es un enlace corto tipo vm.tiktok.com
      if (entrada.includes('vm.tiktok.com')) {
        const expandido = await expandirUrl(entrada);
        if (!expandido) {
          resultado.textContent = 'No se pudo expandir el enlace corto.';
          return;
        }
        finalUrl = expandido;
      }

      const limpio = limpiarQuery(finalUrl);
      if (!limpio) {
        resultado.textContent = 'Error al procesar el enlace.';
        return;
      }

      resultado.innerHTML = `Enlace limpio: <a href="${limpio}" target="_blank">${limpio}</a>`;
    }
  </script>
</body>
</html>